# #############################################################################
# ## CONFIGURATION
# #############################################################################

include:
  # Templates CIâš¡CD
  # ğŸ“„ Documentation: https://gitlab.com/sport-up-group/sportup-templates
  - project: sport-up-group/sportup-templates
    ref: main
    file: main.yml
  # Automatic Config Environment
  # Configue automaticly the environment from .env on develop, staging or tags
  - project: sport-up-group/sportup-templates
    ref: main
    file: config-env.yml

stages:
  - âš™ï¸ Config
  - ğŸ”‘ Authentication
  - ğŸ› ï¸ Build
  - ğŸ§ª Test
  - ğŸ”– Versioning
  - ğŸ”¬ Analyse

variables:
  NEED_ENV: false

# #############################################################################
# ## AUTHENTICATION
# #############################################################################

gitlab:npmrc:
  extends: .gitlab:npmrc
  stage: ğŸ”‘ Authentication
  only:
    - main

# #############################################################################
# ## BUILD
# #############################################################################

node:install:
  extends: .node:install
  stage: ğŸ› ï¸ Build
  needs: ['gitlab:npmrc']
  only:
    - main

node:build:
  extends: .node:build
  stage: ğŸ› ï¸ Build
  needs: ['node:install']
  only:
    - main

# #############################################################################
# ## TEST
# #############################################################################

node:test:
  extends: .node:test
  stage: ğŸ§ª Test
  needs: ['node:install']
  only:
    - main

# #############################################################################
# ## TAG MANAGEMENT
# #############################################################################

tag:create:
  extends: .tag:create
  image: node:22-alpine
  stage: ğŸ”– Versioning
  needs: ['node:build', 'node:test']
  variables:
    FILE_VERSION_PATH: './package.json'
    TAG: ''
    ON_TAG_CREATED: 'npm prune --production && npm publish'

release:create:
  extends: .release:create
  stage: ğŸ”– Versioning

# #############################################################################
# ## ANALYSE
# #############################################################################

sonarqube:check:
  extends: .sonarqube:check
  stage: ğŸ”¬ Analyse
  needs: ['node:test']
  only:
    - main
